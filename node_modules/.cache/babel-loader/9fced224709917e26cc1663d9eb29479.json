{"remainingRequest":"/Users/isaac/Documents/workSpace/statistics-web/node_modules/_babel-loader@8.2.2@babel-loader/lib/index.js!/Users/isaac/Documents/workSpace/statistics-web/node_modules/_eslint-loader@2.2.1@eslint-loader/index.js??ref--13-0!/Users/isaac/Documents/workSpace/statistics-web/src/api/interceptors.js","dependencies":[{"path":"/Users/isaac/Documents/workSpace/statistics-web/src/api/interceptors.js","mtime":1628760504664},{"path":"/Users/isaac/Documents/workSpace/statistics-web/node_modules/_cache-loader@4.1.0@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/isaac/Documents/workSpace/statistics-web/node_modules/_babel-loader@8.2.2@babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/isaac/Documents/workSpace/statistics-web/node_modules/_eslint-loader@2.2.1@eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9Vc2Vycy9pc2FhYy9Eb2N1bWVudHMvd29ya1NwYWNlL3N0YXRpc3RpY3Mtd2ViL25vZGVfbW9kdWxlcy9fQGJhYmVsX3J1bnRpbWVANy4xNC44QEBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7Ci8vIGF4aW9zCmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7IC8vIOi3r+eUsQoKaW1wb3J0IHJvdXRlciBmcm9tICcuLi9yb3V0ZXInOyAvLyBsb2FkaW5nCgppbXBvcnQgeyBMb2FkaW5nLCBNZXNzYWdlIH0gZnJvbSAnZWxlbWVudC11aSc7CnZhciBsb2FkaW5nSW5pdDsgLy8g5re75Yqg6K+35rGC5ZKM5ZON5bqU5oum5oiq5ZmoCgpleHBvcnQgZGVmYXVsdCAoZnVuY3Rpb24gKCkgewogIC8vIOmFjee9ruivt+axggogIHZhciBjYW5jZWxUb2tlbiA9IGF4aW9zLkNhbmNlbFRva2VuOwogIHZhciBzb3VyY2UgPSBjYW5jZWxUb2tlbi5zb3VyY2UoKTsgLy8g5re75Yqg6K+35rGC5oum5oiq5ZmoCgogIGF4aW9zLmludGVyY2VwdG9ycy5yZXF1ZXN0LnVzZShmdW5jdGlvbiAoY29uZmlnKSB7CiAgICB2YXIgdXJsID0gY29uZmlnLnVybDsgLy8gTG9hZGluZwoKICAgIGlmIChjb25maWcuaGVhZGVycy5uZWVkTG9hZGluZykgewogICAgICBsb2FkaW5nSW5pdCA9IExvYWRpbmcuc2VydmljZSh7CiAgICAgICAgbG9jazogdHJ1ZSwKICAgICAgICB0ZXh0OiAn5Yqg6L295LitwrfCt8K3JywKICAgICAgICBzcGlubmVyOiAnZWwtaWNvbi1sb2FkaW5nJywKICAgICAgICBiYWNrZ3JvdW5kOiAncmdiYSgwLCAwLCAwLCAwLjcpJwogICAgICB9KTsKICAgIH0gLy/miYDmnInnmoTor7fmsYLkuK3phY3nva7nmoTmmK/lkIzkuIDkuKpjYW5jZWxUb2tlbu+8jOaJgOS7peWcqOS5i+WQjueahOaJgOacieivt+axgumDveS8muebtOaOpeaJp+ihjG9uQ2FuY2VsZWTmlrnms5UgICAgICAgIGNvbmZpZy5jYW5jZWxUb2tlbiA9IHNvdXJjZS50b2tlbjsKCgogICAgaWYgKGNvbmZpZy5oZWFkZXJzLmZpbGUpIHsKICAgICAgY29uZmlnLmhlYWRlcnNbIkNvbnRlbnQtdHlwZSJdID0gIm11bHRpcGFydC9mb3JtLWRhdGEiOwogICAgfSBlbHNlIHsKICAgICAgY29uZmlnLmhlYWRlcnNbIkNvbnRlbnQtdHlwZSJdID0gImFwcGxpY2F0aW9uL2pzb24iOwogICAgfSAvLyDmt7vliqB0b2tlbgoKCiAgICBjb25maWcuaGVhZGVyc1snWC1Ub2tlbiddID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3Rva2VuJyk7CgogICAgaWYgKGNvbmZpZy5tZXRob2QgPT09ICdnZXQnICYmIGNvbmZpZy5wYXJhbXMpIHsKICAgICAgdXJsICs9ICc/JzsgLy8g5ou85o6l5Y+C5pWwCiAgICAgIC8vIOiOt+WPluaJgOacieWPguaVsO+8jOmAmui/h+W+queOryDmi7zmjqXmiYDmnInlj4LmlbDvvIxlbmNvZGVVUklDb21wb25lbnTlr7nlj4LmlbDnvJbnoIHvvIwKCiAgICAgIE9iamVjdC5rZXlzKGNvbmZpZy5wYXJhbXMpLm1hcChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgdXJsICs9ICIiLmNvbmNhdChrZXksICI9IikuY29uY2F0KGVuY29kZVVSSUNvbXBvbmVudChjb25maWcucGFyYW1zW2tleV0pLCAiJiIpOwogICAgICB9KTsKICAgICAgdXJsID0gdXJsLnN1YnN0cmluZygwLCB1cmwubGVuZ3RoIC0gMSk7IC8vIOWIoOmZpOacgOWQjuS4gOS4qiblrZfnrKYKCiAgICAgIGNvbmZpZy5wYXJhbXMgPSB7fTsgLy8g5Y+C5pWw5bey57uP5a2Y5Zyo5LqOIHVybOS4rQogICAgfQoKICAgIGNvbmZpZy51cmwgPSB1cmw7CiAgICByZXR1cm4gY29uZmlnOwogIH0sIGZ1bmN0aW9uIChlcnJvcikgewogICAgLy8g5a+56K+35rGC6ZSZ6K+v5YGa5Lqb5LuA5LmICiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwogIH0pOyAvLyDmt7vliqDlk43lupTmi6bmiKrlmagKCiAgYXhpb3MuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLnVzZSggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgIHZhciBfcmVmID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlKHJlc3BvbnNlKSB7CiAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAvLyDlhbPpl61sb2FkaW5nCiAgICAgICAgICAgICAgbG9hZGluZ0luaXQgJiYgbG9hZGluZ0luaXQuY2xvc2UoKTsgLy8g57uf5LiA5aSE55CG6Z2eMjAw55qE6ZSZ6K+v5aSE55CGCgogICAgICAgICAgICAgIGlmICghKHJlc3BvbnNlLmRhdGEuY29kZSAmJiByZXNwb25zZS5kYXRhLmNvZGUgIT09IDIwMCkpIHsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgTWVzc2FnZS5lcnJvcih7CiAgICAgICAgICAgICAgICBtZXNzYWdlOiByZXNwb25zZS5kYXRhLm1lc3NhZ2UsCiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTAwMAogICAgICAgICAgICAgIH0pOyAvLyDlr7nlk43lupTmlbDmja40MDHlgZrngrnku4DkuYgKCiAgICAgICAgICAgICAgaWYgKCEocmVzcG9uc2UuZGF0YS5jb2RlID09PSA0MDEpKSB7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gOTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgLy8g5Y+W5raI5omA5pyJ6K+35rGCCiAgICAgICAgICAgICAgc291cmNlLmNhbmNlbCgpOyAvLyDlj5bmtojor7fmsYLkuYvlkI7vvIzph43mlrDphY3nva5zb3VyY2UKCiAgICAgICAgICAgICAgY2FuY2VsVG9rZW4gPSBheGlvcy5DYW5jZWxUb2tlbjsKICAgICAgICAgICAgICBzb3VyY2UgPSBjYW5jZWxUb2tlbi5zb3VyY2UoKTsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gOTsKICAgICAgICAgICAgICByZXR1cm4gcm91dGVyLnB1c2goewogICAgICAgICAgICAgICAgcGF0aDogJy9sb2dpbicKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBQcm9taXNlLnJlamVjdCgpKTsKCiAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgcmVzcG9uc2UpOwoKICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwgX2NhbGxlZSk7CiAgICB9KSk7CgogICAgcmV0dXJuIGZ1bmN0aW9uIChfeCkgewogICAgICByZXR1cm4gX3JlZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICB9KCksIGZ1bmN0aW9uIChlcnJvcikgewogICAgaWYgKGVycm9yLnJlc3BvbnNlLmRhdGEuY29kZSA9PSA0MDEpIHsKICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd0b2tlbicpOwogICAgICByb3V0ZXIucHVzaCh7CiAgICAgICAgcGF0aDogJy9sb2dpbicKICAgICAgfSk7CiAgICB9IC8vIOWFs+mXrWxvYWRpbmcKCgogICAgbG9hZGluZ0luaXQgJiYgbG9hZGluZ0luaXQuY2xvc2UoKTsgLy8g5a+55ZON5bqU6ZSZ6K+v5YGa54K55LuA5LmICgogICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICB9KTsKfSk7"},{"version":3,"sources":["/Users/isaac/Documents/workSpace/statistics-web/src/api/interceptors.js"],"names":["axios","router","Loading","Message","loadingInit","cancelToken","CancelToken","source","interceptors","request","use","config","url","headers","needLoading","service","lock","text","spinner","background","file","localStorage","getItem","method","params","Object","keys","map","key","encodeURIComponent","substring","length","error","Promise","reject","response","close","data","code","message","duration","cancel","push","path","window","removeItem"],"mappings":"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","sourcesContent":["// axios\r\nimport axios from 'axios';\r\n// 路由\r\nimport router from '../router';\r\n// loading\r\nimport { Loading, Message } from 'element-ui';\r\n\r\nlet loadingInit;\r\n\r\n// 添加请求和响应拦截器\r\nexport default () => {\r\n    // 配置请求\r\n    let cancelToken = axios.CancelToken;\r\n    let source = cancelToken.source();\r\n    // 添加请求拦截器\r\n    axios.interceptors.request.use((config) => {\r\n        let url= config.url;\r\n        // Loading\r\n        if (config.headers.needLoading) {\r\n            loadingInit = Loading.service({\r\n                lock: true,\r\n                text: '加载中···',\r\n                spinner: 'el-icon-loading',\r\n                background: 'rgba(0, 0, 0, 0.7)'\r\n            });\r\n        }\r\n        //所有的请求中配置的是同一个cancelToken，所以在之后的所有请求都会直接执行onCanceled方法        config.cancelToken = source.token;\r\n        if (config.headers.file){\r\n            config.headers[\"Content-type\"] = \"multipart/form-data\";\r\n        }else{\r\n            config.headers[\"Content-type\"] = \"application/json\";\r\n        }\r\n        // 添加token\r\n        config.headers['X-Token'] = localStorage.getItem('token');\r\n        if (config.method === 'get' && config.params) {\r\n            url += '?' // 拼接参数\r\n            // 获取所有参数，通过循环 拼接所有参数，encodeURIComponent对参数编码，\r\n            Object.keys(config.params).map(key => {\r\n                url += `${key}=${encodeURIComponent(config.params[key])}&`\r\n            })\r\n            url = url.substring(0, url.length - 1) // 删除最后一个&字符\r\n            config.params = {} // 参数已经存在于 url中\r\n        }\r\n        config.url = url;\r\n        return config;\r\n    }, (error) => {\r\n        // 对请求错误做些什么\r\n        return Promise.reject(error);\r\n    });\r\n    // 添加响应拦截器\r\n    axios.interceptors.response.use(async (response) => {\r\n        // 关闭loading\r\n        loadingInit && loadingInit.close();\r\n        // 统一处理非200的错误处理\r\n        if (response.data.code && response.data.code !== 200) {\r\n            Message.error({\r\n                message: response.data.message,\r\n                duration: 1000\r\n            });\r\n            // 对响应数据401做点什么\r\n            if (response.data.code === 401) {\r\n                // 取消所有请求\r\n                source.cancel();\r\n                // 取消请求之后，重新配置source\r\n                cancelToken = axios.CancelToken;\r\n                source = cancelToken.source();\r\n                await router.push({ path: '/login' });\r\n            }\r\n            return Promise.reject()\r\n        }else{\r\n            //请求成功才回调\r\n            return response;\r\n        }\r\n    }, (error) => {\r\n        if (error.response.data.code==401) {\r\n            window.localStorage.removeItem('token')\r\n            router.push({ path: '/login' });\r\n        }\r\n        // 关闭loading\r\n        loadingInit && loadingInit.close();\r\n        // 对响应错误做点什么\r\n        return Promise.reject(error);\r\n    });\r\n};\r\n"]}]}